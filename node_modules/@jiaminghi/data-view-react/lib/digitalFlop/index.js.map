{"version":3,"file":"index.js","sources":["../../src/components/digitalFlop/index.js"],"sourcesContent":["import React, { useEffect, useRef, useMemo } from 'react'\n\nimport PropTypes from 'prop-types'\n\nimport classnames from 'classnames'\n\nimport CRender from '@jiaminghi/c-render'\n\nimport '@jiaminghi/charts/lib/extend/index'\n\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index'\n\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util'\n\nimport './style.less'\n\nconst defaultConfig = {\n  /**\n   * @description Number for digital flop\n   * @type {Array<Number>}\n   * @default number = []\n   * @example number = [10]\n   */\n  number: [],\n  /**\n   * @description Content formatter\n   * @type {String}\n   * @default content = ''\n   * @example content = '{nt}个'\n   */\n  content: '',\n  /**\n   * @description Number toFixed\n   * @type {Number}\n   * @default toFixed = 0\n   */\n  toFixed: 0,\n  /**\n   * @description Text align\n   * @type {String}\n   * @default textAlign = 'center'\n   * @example textAlign = 'center' | 'left' | 'right'\n   */\n  textAlign: 'center',\n  /**\n   * @description Text style configuration\n   * @type {Object} {CRender Class Style}\n   */\n  style: {\n    fontSize: 30,\n    fill: '#3de7c9'\n  },\n  /**\n   * @description CRender animationCurve\n   * @type {String}\n   * @default animationCurve = 'easeOutCubic'\n   */\n  animationCurve: 'easeOutCubic',\n  /**\n   * @description CRender animationFrame\n   * @type {String}\n   * @default animationFrame = 50\n   */\n  animationFrame: 50\n}\n\nconst DigitalFlop = ({ config = {}, className, style }) => {\n  const domRef = useRef(null)\n  const rendererRef = useRef(null)\n  const graphRef = useRef(null)\n\n  function getGraph(mergedConfig) {\n    const { animationCurve, animationFrame } = mergedConfig\n\n    return rendererRef.current.add({\n      name: 'numberText',\n      animationCurve,\n      animationFrame,\n      shape: getShape(mergedConfig),\n      style: getStyle(mergedConfig)\n    })\n  }\n\n  function getShape({ number, content, toFixed, textAlign }) {\n    const [w, h] = rendererRef.current.area\n\n    const position = [w / 2, h / 2]\n\n    if (textAlign === 'left') position[0] = 0\n    if (textAlign === 'right') position[0] = w\n\n    return { number, content, toFixed, position }\n  }\n\n  function getStyle({ style, textAlign }) {\n    return deepMerge(style, {\n      textAlign,\n      textBaseline: 'middle'\n    })\n  }\n\n  useEffect(() => {\n    const mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {})\n\n    if (!rendererRef.current) {\n      rendererRef.current = new CRender(domRef.current)\n\n      graphRef.current = getGraph(mergedConfig)\n    }\n\n    const graph = graphRef.current\n    graph.animationEnd()\n\n    const shape = getShape(mergedConfig)\n\n    const cacheNum = graph.shape.number.length\n    const shapeNum = shape.number.length\n\n    cacheNum !== shapeNum && (graph.shape.number = shape.number)\n\n    const { animationCurve, animationFrame } = mergedConfig\n\n    Object.assign(graph, { animationCurve, animationFrame })\n\n    graph.animation('style', getStyle(mergedConfig), true)\n    graph.animation('shape', shape)\n  }, [config])\n\n  const classNames = useMemo(() => classnames('dv-digital-flop', className), [\n    className\n  ])\n\n  return (\n    <div className={classNames} style={style}>\n      <canvas ref={domRef} />\n    </div>\n  )\n}\n\nDigitalFlop.propTypes = {\n  config: PropTypes.object,\n  className: PropTypes.string,\n  style: PropTypes.object\n}\n\n// 指定 props 的默认值：\nDigitalFlop.defaultProps = {\n  config: {}\n}\n\nexport default DigitalFlop\n"],"names":["defaultConfig","number","content","toFixed","textAlign","style","fontSize","fill","animationCurve","animationFrame","DigitalFlop","config","className","domRef","useRef","rendererRef","graphRef","getGraph","mergedConfig","current","add","name","shape","getShape","getStyle","area","w","h","position","deepMerge","textBaseline","useEffect","deepClone","CRender","graph","animationEnd","cacheNum","length","shapeNum","Object","assign","animation","classNames","useMemo","classnames","React","propTypes","PropTypes","object","string","defaultProps"],"mappings":"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"}